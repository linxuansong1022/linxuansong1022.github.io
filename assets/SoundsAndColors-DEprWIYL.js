const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/p5.min-DKZz00W8.js","assets/index-DROOzKrj.js","assets/index-qG7Hfnfd.css"])))=>i.map(i=>d[i]);
import{r as p,_ as F,j as U}from"./index-DROOzKrj.js";class W{constructor({x:o,y:i,radius:a,color:m,velocity:c,dampening:M}){this.x=o,this.y=i,this.radius=a,this.color=m,this.velocity=c,this.dampening=M,this.ringDist=15}move(){this.x+=this.velocity[0],this.y+=this.velocity[1],this.velocity[0]*=1-this.dampening,this.velocity[1]*=1-this.dampening}isSelected(o){const i=this.x*o.width-o.mouseX,a=this.y*o.height-o.mouseY;return Math.sqrt(i*i+a*a)<this.radius+this.ringDist}render(o,i){let{x:a,y:m,radius:c,color:M}=this,g=o.color(...M);g.setAlpha(o.alpha(g)*i),o.fill(g),o.noStroke(),o.ellipse(a*o.width,m*o.height,c*2,c*2),o.noFill();let P=2,S=o.alpha(g)*1.5;for(let w=0;w<5;w++)c+=this.ringDist,P*=.8,S*=.6,g.setAlpha(S),o.stroke(g),o.strokeWeight(P),o.ellipse(a*o.width,m*o.height,c*2,c*2)}}const O=180,q=270,A=()=>O+Math.random()*(q-O);function L({active:v}){const o=p.useRef(null),i=p.useRef(null),a=p.useRef({particles:[],gradients:[],gidx:0,fiParticles:0,fiGradient:0,foParticles:0,fadeMax:0,timeouts:{},chordSynth:null,leadSynth:null,leadFx:null,chordFx:null,tMin:0,playParticleThrottled:null,toneStarted:!1}),m=24,c=60,M=32,g=1,P=80,S=(e,t)=>1/(1+Math.exp((.5-e)*t)),w=(e,t,s,u,d,f,y)=>{e.noFill(),e.strokeWeight(1);for(let r=t;r<=t+u;r++){const n=e.map(r,t,t+u,0,1),l=e.lerpColor(f,y,n);e.stroke(l),e.line(r,s,r,s+d)}},B=(e,t)=>{let s=0;return(...u)=>{const d=Date.now();d-s>=t&&(s=d,e(...u))}},_=p.useCallback(async()=>{const e=a.current;if(e.toneStarted)return;const t=await F(()=>import("./index-Cvny4KXv.js"),[]);await t.start(),e.toneStarted=!0,e.leadFx=new t.PingPongDelay("8t",.4).toDestination(),e.leadSynth=new t.PolySynth(t.MonoSynth).connect(e.leadFx),e.leadSynth.set({oscillator:{type:"sawtooth"},filter:{type:"lowpass",rolloff:-24,frequency:5e3,Q:10},envelope:{release:"2n",releaseCurve:"linear"},filterEnvelope:{attack:"8n",release:"2n",releaseCurve:"exponential"},volume:-35}),e.chordFx=new t.AutoFilter("4n",1500,.4).toDestination().start(),e.chordSynth=new t.PolySynth(t.FMSynth).connect(e.chordFx),e.chordSynth.set({envelope:{attack:"2n",release:"1n",releaseCurve:"linear"},modulationEnvelope:{attack:"1m",sustain:1,release:"1n",releaseCurve:"linear"},modulationIndex:10,volume:-35}),t.getTransport().bpm.value=c,e.tMin=t.Time("4n").toSeconds()*1e3,e.playParticleThrottled=B(s=>{const u=["1","2","3","4","5","6"],d=["C","E","G","B"],{radius:f,velocity:y,color:r}=s,n=Math.floor((1-f/P)*u.length),l=Math.sqrt(y[0]**2+y[1]**2),h=Math.floor(l/1e-4*d.length),x=u[Math.min(n,u.length-1)],E=d[h%d.length]+x,T=r[3]*3;e.leadSynth.triggerAttackRelease(E,"4n","+0",T)},e.tMin)},[]),G=p.useCallback(()=>{const e=a.current,t={c1:[A(),80,90,.7],c2:[A(),70,85,.5]};e.gidx=(e.gidx+1)%2,e.gradients[e.gidx]=t,e.fiGradient=0},[]),I=p.useCallback(()=>{const e=a.current;e.particles=[];for(let t=0;t<M;t++)e.particles.push(new W({x:Math.random(),y:Math.random(),radius:1+Math.random()*P,color:[A(),20,100,.01+Math.random()*.5],velocity:[(Math.random()-.5)*.01,(Math.random()-.5)*.01],dampening:Math.random()*.05}));e.fiParticles=0},[]),R=p.useCallback(()=>{const e=a.current;e.foParticles=0,e.leadSynth&&e.leadSynth.releaseAll()},[]),D=p.useCallback(()=>{const e=a.current;if(!e.chordSynth)return;const t=[["E3","G3","B3","D4"],["C3","E3","G3","B3"],["D3","G3","B3","D4"],["A2","C3","E3","G3"]],s=t[Math.floor(Math.random()*t.length)];e.chordSynth.triggerAttackRelease(s,"1:2:0")},[]);return p.useEffect(()=>{if(!v)return;let e=null;const t=a.current;return(async()=>{const d=(await F(()=>import("./p5.min-DKZz00W8.js").then(n=>n.p),__vite__mapDeps([0,1,2]))).default,f=6e4/c;t.fadeMax=f*g/m/2;const y=n=>{n.setup=()=>{n.createCanvas(n.windowWidth,n.windowHeight).parent(o.current),n.frameRate(m),n.colorMode(n.HSB),n.background(255)},n.draw=()=>{if(n.background(255),t.gradients.length>0){const{c1:l,c2:h}=t.gradients[t.gidx];let x=n.color(...l),C=n.color(...h);if(t.fiGradient<t.fadeMax){const E=(t.gidx+1)%2,T=t.gradients[E]||{c1:[255],c2:[255]},H=n.color(...T.c1),j=n.color(...T.c2),b=S(t.fiGradient/t.fadeMax,10);x=n.lerpColor(H,x,b),C=n.lerpColor(j,C,b)}w(n,0,0,n.width,n.height,x,C)}t.particles.forEach(l=>{let h=1;t.fiParticles<t.fadeMax?h=t.fiParticles/t.fadeMax:t.foParticles<t.fadeMax?h=1-t.foParticles/t.fadeMax:t.foParticles<t.fiParticles&&(h=0),l.isSelected(n)&&h>0&&(h*=3,t.playParticleThrottled&&t.playParticleThrottled(l)),l.render(n,h),l.move()}),t.fiGradient++,t.fiParticles++,t.foParticles++},n.windowResized=()=>{n.resizeCanvas(n.windowWidth,n.windowHeight)}};e=new d(y),i.current=e,await _();const r=f*8;t.timeouts.fadeGradient=setTimeout(function n(){G(),D(),t.timeouts.fadeGradient=setTimeout(n,r)},f*0),t.timeouts.fadeInParticles=setTimeout(function n(){I(),t.timeouts.fadeInParticles=setTimeout(n,r)},f*1),t.timeouts.fadeOutParticles=setTimeout(function n(){R(),t.timeouts.fadeOutParticles=setTimeout(n,r)},f*7)})(),()=>{clearTimeout(t.timeouts.fadeGradient),clearTimeout(t.timeouts.fadeInParticles),clearTimeout(t.timeouts.fadeOutParticles),t.timeouts={},t.particles=[],t.gradients=[],t.chordSynth&&t.chordSynth.releaseAll(),t.leadSynth&&t.leadSynth.releaseAll(),i.current&&(i.current.remove(),i.current=null)}},[v,_,G,I,R,D]),v?U.jsx("div",{ref:o,style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:0,pointerEvents:"auto"}}):null}export{L as default};
